---
phase: 01-user-acquisition
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - emrun-frontend/package.json
  - emrun-frontend/src/i18n/index.ts
  - emrun-frontend/src/i18n/locales/fr.json
  - emrun-frontend/app/(questionnaire)/_layout.tsx
  - emrun-frontend/app/(questionnaire)/step1.tsx
  - emrun-frontend/app/(questionnaire)/step2.tsx
  - emrun-frontend/app/(questionnaire)/step3.tsx
  - emrun-frontend/app/(questionnaire)/step4.tsx
  - emrun-frontend/app/(questionnaire)/step4a.tsx
  - emrun-frontend/app/(questionnaire)/step5.tsx
  - emrun-frontend/app/(questionnaire)/step6.tsx
  - emrun-frontend/app/(questionnaire)/step7.tsx
  - emrun-frontend/app/(questionnaire)/step8.tsx
  - emrun-frontend/app/(questionnaire)/step9.tsx
  - emrun-frontend/components/ui/WheelPicker.tsx
  - emrun-frontend/components/ui/ProgressIndicator.tsx
  - emrun-frontend/contexts/QuestionnaireContext.tsx
autonomous: true

must_haves:
  truths:
    - "User completes 9-step questionnaire without creating account"
    - "User navigates back/forward through questionnaire without losing data"
    - "All questionnaire text displays in French"
    - "Wheel pickers work for age, weight, height, volume, experience inputs"
    - "Progress indicator shows current step (e.g., 2/9)"
    - "Conditional logic shows race questions only if preparing for race"
  artifacts:
    - path: "emrun-frontend/src/i18n/locales/fr.json"
      provides: "French translations for all questionnaire steps"
      contains: "onboarding"
    - path: "emrun-frontend/components/ui/WheelPicker.tsx"
      provides: "Reusable wheel picker component"
      exports: ["WheelPicker"]
    - path: "emrun-frontend/components/ui/ProgressIndicator.tsx"
      provides: "Step progress indicator (N/9)"
      exports: ["ProgressIndicator"]
    - path: "emrun-frontend/contexts/QuestionnaireContext.tsx"
      provides: "Questionnaire state persistence across steps"
      exports: ["QuestionnaireProvider", "useQuestionnaire"]
  key_links:
    - from: "emrun-frontend/app/(questionnaire)/step*.tsx"
      to: "QuestionnaireContext"
      via: "useQuestionnaire hook"
      pattern: "useQuestionnaire"
    - from: "emrun-frontend/app/(questionnaire)/*.tsx"
      to: "fr.json"
      via: "useTranslation hook"
      pattern: "useTranslation|t\\("
---

<objective>
Complete the 9-step anonymous questionnaire with modern wheel pickers, French localization, and state persistence.

Purpose: This is the first touchpoint for user acquisition. A polished, native-feeling questionnaire with value-first UX converts runners into subscribers.

Output: Fully functional questionnaire flow that collects user data anonymously, persists state across navigation, and displays all text in French.
</objective>

<execution_context>
@C:\Users\dell\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dell\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-user-acquisition/01-RESEARCH.md

# Existing frontend files
@emrun-frontend/package.json
@emrun-frontend/app/(questionnaire)/_layout.tsx
@emrun-frontend/contexts/QuestionnaireContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and setup i18n</name>
  <files>
    emrun-frontend/package.json
    emrun-frontend/src/i18n/index.ts
    emrun-frontend/src/i18n/locales/fr.json
    emrun-frontend/app/_layout.tsx
  </files>
  <action>
Install required dependencies:
- @quidone/react-native-wheel-picker (wheel picker component)
- react-i18next and i18next (French localization)
- expo-secure-store (for later auth token storage)

Run: `cd emrun-frontend && npm install @quidone/react-native-wheel-picker react-i18next i18next expo-secure-store`

Create i18n setup:
1. Create `src/i18n/index.ts` - Initialize i18next with French as default language
2. Create `src/i18n/locales/fr.json` - French translations for all 9 questionnaire steps including:
   - Step titles and descriptions
   - Button labels ("Continuer", "Retour")
   - Input labels and placeholders
   - Validation error messages
   - All running-specific terminology in French

Translation structure:
```json
{
  "onboarding": {
    "progress": "{{current}}/{{total}}",
    "continue": "Continuer",
    "back": "Retour",
    "step1": {
      "title": "Quel est votre objectif principal?",
      "options": {
        "health": "Rester en forme",
        "race": "Preparer une course",
        "improve": "Ameliorer mes performances"
      }
    },
    // ... steps 2-9
  }
}
```

Update `app/_layout.tsx` to import and initialize i18n before app renders.
  </action>
  <verify>
- `npm ls @quidone/react-native-wheel-picker` shows installed
- `npm ls react-i18next` shows installed
- File `src/i18n/locales/fr.json` exists with questionnaire translations
- App starts without i18n errors: `npx expo start`
  </verify>
  <done>
Dependencies installed. i18n configured with French translations. App initializes with French locale.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create reusable UI components (WheelPicker, ProgressIndicator)</name>
  <files>
    emrun-frontend/components/ui/WheelPicker.tsx
    emrun-frontend/components/ui/ProgressIndicator.tsx
  </files>
  <action>
Create WheelPicker component (`components/ui/WheelPicker.tsx`):
- Wrap @quidone/react-native-wheel-picker with consistent styling
- Props: `options: {label: string, value: any}[]`, `selectedValue`, `onValueChange`, `label?`
- Dark theme styling (matches app design: dark background, blue accent #318ce7)
- Haptic feedback on selection (use expo-haptics if available, graceful fallback)
- TypeScript types for all props

Example interface:
```typescript
interface WheelPickerProps {
  options: { label: string; value: string | number }[];
  selectedValue: string | number;
  onValueChange: (value: string | number) => void;
  label?: string;
}
```

Create ProgressIndicator component (`components/ui/ProgressIndicator.tsx`):
- Shows "N/9" text and progress bar
- Props: `currentStep: number`, `totalSteps: number`
- Animated fill bar (use React Native Animated or basic width transition)
- Dark theme styling with blue accent for progress fill
- Positioned consistently across all questionnaire screens

Both components should:
- Use consistent dark theme colors (background #0a0a0a, accent #318ce7)
- Be fully typed with TypeScript
- Export as named exports
  </action>
  <verify>
- File `components/ui/WheelPicker.tsx` exists and exports WheelPicker
- File `components/ui/ProgressIndicator.tsx` exists and exports ProgressIndicator
- No TypeScript errors: `cd emrun-frontend && npx tsc --noEmit`
  </verify>
  <done>
WheelPicker and ProgressIndicator components created with dark theme styling and TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement QuestionnaireContext and complete all 9 steps</name>
  <files>
    emrun-frontend/contexts/QuestionnaireContext.tsx
    emrun-frontend/app/(questionnaire)/_layout.tsx
    emrun-frontend/app/(questionnaire)/step1.tsx
    emrun-frontend/app/(questionnaire)/step2.tsx
    emrun-frontend/app/(questionnaire)/step3.tsx
    emrun-frontend/app/(questionnaire)/step4.tsx
    emrun-frontend/app/(questionnaire)/step4a.tsx
    emrun-frontend/app/(questionnaire)/step5.tsx
    emrun-frontend/app/(questionnaire)/step6.tsx
    emrun-frontend/app/(questionnaire)/step7.tsx
    emrun-frontend/app/(questionnaire)/step8.tsx
    emrun-frontend/app/(questionnaire)/step9.tsx
    emrun-frontend/app/(questionnaire)/preview.tsx
  </files>
  <action>
Create/update QuestionnaireContext (`contexts/QuestionnaireContext.tsx`):
- Store all questionnaire answers in context state
- Generate anonymous session UUID on first access (use crypto.randomUUID or uuid library)
- Persist state to AsyncStorage so data survives app restart
- Provide `updateAnswer(stepKey, value)` and `getAnswers()` methods
- Track `currentStep` for progress indicator

Interface for questionnaire data:
```typescript
interface QuestionnaireData {
  sessionId: string;
  goal: 'health' | 'race' | 'improve';
  age: number;
  weight: number;
  height: number;
  experience: 'beginner' | 'intermediate' | 'advanced';
  weeklyVolume: number; // km per week
  availableDays: number[];
  preparingRace?: boolean;
  raceType?: string;
  raceDate?: string;
  raceGoalTime?: string;
}
```

Update questionnaire layout (`app/(questionnaire)/_layout.tsx`):
- Wrap in QuestionnaireProvider
- Use Stack navigator (already using Expo Router)
- Ensure gesture-based back navigation works on iOS

Complete/fix each step screen:
- **step1.tsx**: Goal selection (3 options: health, race, improve) - use styled buttons not picker
- **step2.tsx**: Age wheel picker (18-80 range)
- **step3.tsx**: Weight wheel picker (40-150 kg)
- **step4.tsx**: Height wheel picker (140-220 cm)
- **step4a.tsx**: Conditional race questions (only if goal=race)
  - Race type (5K, 10K, semi-marathon, marathon, trail, autre)
  - Race date (date picker)
  - Goal time (wheel picker with time options)
- **step5.tsx**: Experience level (beginner, intermediate, advanced) - styled buttons
- **step6.tsx**: Weekly volume wheel picker (0-100+ km/week)
- **step7.tsx**: Available training days (multi-select: Mon-Sun)
- **step8.tsx**: Personal records or additional preferences
- **step9.tsx**: Summary/confirmation before proceeding to preview

Create preview screen (`app/(questionnaire)/preview.tsx`):
- Display personalized plan preview based on answers
- Show sample week structure (workouts per day based on availability)
- Call to action: "Voir le prix" button to proceed to pricing

Each step must:
- Use ProgressIndicator at top showing "N/9"
- Use useTranslation() for all text (French)
- Use WheelPicker for numeric inputs
- Save answer to QuestionnaireContext on "Continue"
- Support back navigation without losing data (context persists)
- Follow dark theme (background #0a0a0a, text white, accent #318ce7)
- Have "Continuer" button at bottom (disabled until selection made)

Conditional logic for step4a:
```typescript
// In step4 or navigation logic
const { answers } = useQuestionnaire();
if (answers.goal === 'race') {
  router.push('/(questionnaire)/step4a');
} else {
  router.push('/(questionnaire)/step5');
}
```
  </action>
  <verify>
- All 9 steps + preview screen files exist in `app/(questionnaire)/`
- Navigate through complete flow: `npx expo start`, go through all steps
- Back navigation preserves entered data
- Step 4a only appears when goal is "race"
- Progress indicator updates correctly (shows 2/9, 3/9, etc.)
- All text displays in French
  </verify>
  <done>
Complete 9-step questionnaire with:
- Anonymous session tracking
- State persistence across navigation
- Wheel pickers for numeric inputs
- French localization throughout
- Conditional race question flow
- Plan preview screen at end
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Fresh flow test**: Clear AsyncStorage, launch app, complete full questionnaire flow
   - All 9 steps work with proper inputs
   - Progress indicator accurate
   - All text in French

2. **Back navigation test**: Navigate to step 5, go back to step 2, change answer, continue
   - Previous answers preserved
   - New answer saved correctly

3. **Conditional logic test**:
   - Select "Preparer une course" -> should see race questions (step4a)
   - Select "Rester en forme" -> should skip to experience (step5)

4. **Persistence test**: Complete to step 4, close app, reopen
   - Should resume from step 4 with answers preserved

5. **TypeScript check**: `npx tsc --noEmit` passes with no errors
</verification>

<success_criteria>
- User completes all 9 questionnaire steps without creating account
- User navigates back and forward without losing data
- All text displays in French
- Wheel pickers work smoothly for numeric inputs (age, weight, height, volume)
- Progress indicator shows current step accurately
- Conditional race questions appear only when relevant
- Questionnaire data persists across app restarts
- Preview screen shows personalized plan summary
</success_criteria>

<output>
After completion, create `.planning/phases/01-user-acquisition/01-01-SUMMARY.md`
</output>
